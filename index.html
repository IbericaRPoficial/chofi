<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Para Chofi ❤️</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --correct: #6aaa64;
            --present: #c9b458;
            --absent: #3a3a3c;
            --bg: #121213;
            --tile-border: #3a3a3c;
            --pink: #ff6b6b;
        }

        body {
            background-color: var(--bg);
            color: white;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
            margin: 0;
        }

        h1 { color: var(--pink); margin-bottom: 5px; }
        #phrase-display { margin-bottom: 20px; font-size: 1.2rem; color: #888; min-height: 1.5em; }
        #phrase-display span { color: var(--correct); font-weight: bold; margin-right: 5px; }

        .grid { display: grid; gap: 5px; margin-bottom: 20px; }
        
        .row { display: flex; gap: 5px; }

        .tile {
            width: 50px;
            height: 50px;
            border: 2px solid var(--tile-border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            text-transform: uppercase;
            transition: transform 0.3s;
        }

        .tile.correct { background-color: var(--correct); border-color: var(--correct); }
        .tile.present { background-color: var(--present); border-color: var(--present); }
        .tile.absent { background-color: var(--absent); border-color: var(--absent); }
        .tile.pop { transform: scale(1.1); border-color: #565758; }

        #input-area { margin-top: 10px; }
        input {
            padding: 10px;
            font-size: 1rem;
            border-radius: 5px;
            border: none;
            outline: none;
            text-align: center;
            width: 200px;
            text-transform: uppercase;
        }

        #final-card {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            color: black;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            z-index: 100;
            box-shadow: 0 0 20px var(--pink);
        }

        .shake { animation: shake 0.4s; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body>

    <h1>Para Sofía ❤️</h1>
    <div id="phrase-display"></div>
    <div id="game-container"></div>

    <div id="input-area">
        <input type="text" id="guess-input" placeholder="Adivina la palabra..." autocomplete="off">
    </div>

    <div id="final-card">
        <h2 style="color: var(--pink); margin: 0;">¡Te quiero mucho Chofi! ❤️</h2>
        <p id="full-phrase-text" style="font-weight: bold; margin-top: 15px;"></p>
    </div>

    <script>
        const phrase = ["Estuve", "enamorado", "de", "ti", "pero", "creo", "que", "he", "vuelto", "de", "nuevo"];
        let currentWordIndex = 0;
        
        const container = document.getElementById('game-container');
        const phraseDisplay = document.getElementById('phrase-display');
        const input = document.getElementById('guess-input');
        const finalCard = document.getElementById('final-card');

        function initWord() {
            container.innerHTML = '';
            const word = phrase[currentWordIndex].toUpperCase();
            const row = document.createElement('div');
            row.className = 'row';
            
            for (let i = 0; i < word.length; i++) {
                const tile = document.createElement('div');
                tile.className = 'tile';
                tile.id = `tile-${i}`;
                row.appendChild(tile);
            }
            container.appendChild(row);
            input.maxLength = word.length;
            input.placeholder = `Palabra de ${word.length} letras`;
            input.value = '';
            input.focus();
        }

        input.addEventListener('keyup', (e) => {
            const word = phrase[currentWordIndex].toUpperCase();
            const guess = input.value.toUpperCase();
            
            // Llenar tiles visualmente mientras escribe
            const tiles = document.querySelectorAll('.tile');
            tiles.forEach((tile, i) => {
                tile.textContent = guess[i] || '';
                tile.classList.toggle('pop', !!guess[i]);
            });

            if (e.key === 'Enter') {
                if (guess.length !== word.length) return;

                checkGuess(guess, word);
            }
        });

        function checkGuess(guess, target) {
            const tiles = document.querySelectorAll('.tile');
            let correctCount = 0;
            const targetArr = target.split('');
            const guessArr = guess.split('');
            const statuses = new Array(target.length).fill('absent');

            // Primera pasada: Verdes
            guessArr.forEach((letter, i) => {
                if (letter === targetArr[i]) {
                    statuses[i] = 'correct';
                    targetArr[i] = null;
                    correctCount++;
                }
            });

            // Segunda pasada: Amarillos
            guessArr.forEach((letter, i) => {
                if (statuses[i] !== 'correct' && targetArr.includes(letter)) {
                    statuses[i] = 'present';
                    targetArr[targetArr.indexOf(letter)] = null;
                }
            });

            // Aplicar colores
            tiles.forEach((tile, i) => {
                tile.className = `tile ${statuses[i]}`;
            });

            if (correctCount === target.length) {
                setTimeout(nextWord, 800);
            } else {
                input.classList.add('shake');
                setTimeout(() => input.classList.remove('shake'), 400);
            }
        }

        function nextWord() {
            // Añadir palabra completada al display
            const span = document.createElement('span');
            span.textContent = phrase[currentWordIndex] + " ";
            phraseDisplay.appendChild(span);

            currentWordIndex++;

            if (currentWordIndex < phrase.length) {
                initWord();
            } else {
                showWin();
            }
        }

        function showWin() {
            document.getElementById('input-area').style.display = 'none';
            container.style.display = 'none';
            finalCard.style.display = 'block';
            document.getElementById('full-phrase-text').textContent = `"${phrase.join(' ')}"`;
            
            confetti({
                particleCount: 200,
                spread: 100,
                origin: { y: 0.6 },
                colors: ['#ff6b6b', '#6aaa64', '#ffffff']
            });
        }

        initWord();
    </script>
</body>
</html>
